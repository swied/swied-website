<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.258">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Scott Wied">
<meta name="dcterms.date" content="2022-11-06">
<meta name="description" content="Get free financial reporting data on any public company from data.sec.gov using an API. You can actually get time series trends for any line item (XBRL tag) in their financial reporting documents.">

<title>Scott’s Data Science Blog - Company Financial Trends</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZZ12P3MMWN"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZZ12P3MMWN', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<link rel="alternate" type="application/rss+xml" title="Scott's Data Science Blog" href="company-financial-trends.xml"></head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Scott’s Data Science Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/scottwied/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text">LinkedIn</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Company Financial Trends</h1>
                  <div>
        <div class="description">
          Get free financial reporting data on any public company from data.sec.gov using an API. You can actually get time series trends for any line item (XBRL tag) in their financial reporting documents.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Pandas</div>
                <div class="quarto-category">API’s</div>
                <div class="quarto-category">Matplotlib</div>
                <div class="quarto-category">Finance</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Scott Wied </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 6, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#intro-to-xbrl-tagging" id="toc-intro-to-xbrl-tagging" class="nav-link" data-scroll-target="#intro-to-xbrl-tagging"><span class="toc-section-number">2</span>  Intro to XBRL tagging</a>
  <ul class="collapse">
  <li><a href="#find-the-cik-for-apple" id="toc-find-the-cik-for-apple" class="nav-link" data-scroll-target="#find-the-cik-for-apple"><span class="toc-section-number">2.1</span>  Find the CIK for Apple</a></li>
  <li><a href="#open-a-10-k-report" id="toc-open-a-10-k-report" class="nav-link" data-scroll-target="#open-a-10-k-report"><span class="toc-section-number">2.2</span>  Open a 10-K report</a></li>
  <li><a href="#find-the-finacial-statements" id="toc-find-the-finacial-statements" class="nav-link" data-scroll-target="#find-the-finacial-statements"><span class="toc-section-number">2.3</span>  Find the finacial statements</a></li>
  <li><a href="#identify-the-net-income-line-item" id="toc-identify-the-net-income-line-item" class="nav-link" data-scroll-target="#identify-the-net-income-line-item"><span class="toc-section-number">2.4</span>  Identify the <em>Net Income</em> line item</a></li>
  <li><a href="#find-the-xbrl-tag-name-for-net-income" id="toc-find-the-xbrl-tag-name-for-net-income" class="nav-link" data-scroll-target="#find-the-xbrl-tag-name-for-net-income"><span class="toc-section-number">2.5</span>  Find the XBRL tag name for <em>Net Income</em></a></li>
  </ul></li>
  <li><a href="#api-data-pull" id="toc-api-data-pull" class="nav-link" data-scroll-target="#api-data-pull"><span class="toc-section-number">3</span>  API data pull</a>
  <ul class="collapse">
  <li><a href="#import-python-packages" id="toc-import-python-packages" class="nav-link" data-scroll-target="#import-python-packages"><span class="toc-section-number">3.1</span>  Import python packages</a></li>
  <li><a href="#make-the-api-call" id="toc-make-the-api-call" class="nav-link" data-scroll-target="#make-the-api-call"><span class="toc-section-number">3.2</span>  Make the API Call</a></li>
  <li><a href="#take-a-look-at-the-raw-json-data" id="toc-take-a-look-at-the-raw-json-data" class="nav-link" data-scroll-target="#take-a-look-at-the-raw-json-data"><span class="toc-section-number">3.3</span>  Take a look at the raw JSON data</a></li>
  <li><a href="#convert-to-a-pandas-dataframe" id="toc-convert-to-a-pandas-dataframe" class="nav-link" data-scroll-target="#convert-to-a-pandas-dataframe"><span class="toc-section-number">3.4</span>  Convert to a Pandas Dataframe</a></li>
  </ul></li>
  <li><a href="#clean-and-filter-data" id="toc-clean-and-filter-data" class="nav-link" data-scroll-target="#clean-and-filter-data"><span class="toc-section-number">4</span>  Clean and filter data</a>
  <ul class="collapse">
  <li><a href="#rank-records-over-fiscal-year-and-period" id="toc-rank-records-over-fiscal-year-and-period" class="nav-link" data-scroll-target="#rank-records-over-fiscal-year-and-period"><span class="toc-section-number">4.1</span>  Rank records over fiscal year and period</a></li>
  <li><a href="#filter-the-dataframe-for-rank1-records" id="toc-filter-the-dataframe-for-rank1-records" class="nav-link" data-scroll-target="#filter-the-dataframe-for-rank1-records"><span class="toc-section-number">4.2</span>  Filter the dataframe for rank=1 records</a></li>
  <li><a href="#finalize-data-for-plotting" id="toc-finalize-data-for-plotting" class="nav-link" data-scroll-target="#finalize-data-for-plotting"><span class="toc-section-number">4.3</span>  Finalize data for plotting</a></li>
  </ul></li>
  <li><a href="#show-trend-as-a-bart-chart" id="toc-show-trend-as-a-bart-chart" class="nav-link" data-scroll-target="#show-trend-as-a-bart-chart"><span class="toc-section-number">5</span>  Show trend as a bart chart</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>If you want to do fundamental research on a publicly traded company, then there are a lot of services that will charge you a lot of money for that data. What if you don’t have a lot of money? And, what if you don’t trust any data that doesn’t come directly from its source? In this article I will show you how to use the vast data resources provided by the US government… for free.</p>
</section>
<section id="intro-to-xbrl-tagging" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="intro-to-xbrl-tagging"><span class="header-section-number">2</span> Intro to XBRL tagging</h2>
<p>A public company is required, by the SEC, to use XBRL line item tags whenever it files its 10-Q (quarterly) and 10-K (annual) financial reports. There is an sec.gov API that you can use to get data on the performance of a companies fundamental metrics over time. You will need the XBRL tag name for each metric that you wish to track.</p>
<p>Below is a quote from an <a href="https://en.wikipedia.org/wiki/XBRL">XBRL Wikipedia article</a> that gives a technical desciption of the XBRL standard:</p>
<blockquote class="blockquote">
<p>XBRL (eXtensible Business Reporting Language) is a freely available and global framework for exchanging business information. XBRL allows the expression of semantic meaning commonly required in business reporting. The language is XML-based and uses the XML syntax and related XML technologies such as XML Schema, XLink, XPath, and Namespaces. One use of XBRL is to define and exchange financial information, such as a financial statement. The XBRL Specification is developed and published by XBRL International, Inc.&nbsp;(XII).</p>
</blockquote>
<p>The SEC has a <a href="https://www.sec.gov/structureddata/osd-inline-xbrl.html">page that describes how they use XBRL</a>. It even includes a link to a <a href="https://youtu.be/zTyhOvE79DQ">YouTube video</a> that you can watch sometime if you are having trouble sleeping.</p>
<p>The best way to become familiar with XBRL is to go through an example. Let’s do that below.</p>
<section id="find-the-cik-for-apple" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="find-the-cik-for-apple"><span class="header-section-number">2.1</span> Find the CIK for Apple</h3>
<p>As and example, let’s use Apple (stock ticker: APPL). Every company that files with the SEC receives a central index key (CIK). The API that we will use requires this CIK code.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a>ticker <span class="op">=</span> <span class="st">'AAPL'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start by <a href="https://www.sec.gov/edgar/searchedgar/companysearch">doing a search for a company on EDGAR</a>. Look for the company CIK code (circled in red below) as you type in the ticker symbol. Write this value down, and then click on the search result.</p>
<p><img src="./resources/sec-edgar-company-lookup.png" width="350"></p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Create a variable from the CIK code in the </span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># above image.  Make sure that the CIK is</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># uppercase, and that there is no space in the name.</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>cik <span class="op">=</span> <span class="st">'CIK0000320193'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="open-a-10-k-report" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="open-a-10-k-report"><span class="header-section-number">2.2</span> Open a 10-K report</h3>
<p>The next page (see below) will display the search results for the chosen company. Notice that the numeric part of the CIK code is included in the URL. Now, click on one of the 10-K or 10-Q reports listed under “Selected Filings”</p>
<p><img src="./resources/sec-edgar-company-search-results.jpg" width="350"></p>
<p>There are several files shown on the Filing Detail page (see below). We are about the top on with the green <font color="green"><em>iXBRL</em></font> note beside it. Click on the link to open the filed report.</p>
<p><img src="./resources/sec-edgar-company-filing-details.png" width="350"></p>
</section>
<section id="find-the-finacial-statements" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="find-the-finacial-statements"><span class="header-section-number">2.3</span> Find the finacial statements</h3>
<p>These SEC filing reports can be quite wordy. Scroll down to the table of contents (see below) after opening the document. Find the section titled <em>Financial Statements</em> and click on the bookmark link. This will take you to the page where you will find several financial reports.</p>
<p><img src="./resources/sec-edgar-company-filing-toc.png" width="350"></p>
</section>
<section id="identify-the-net-income-line-item" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="identify-the-net-income-line-item"><span class="header-section-number">2.4</span> Identify the <em>Net Income</em> line item</h3>
<p>Scroll down a little bit, until you see a table of numbers. These reports are all in a specific format that is mandated by the SEC. Each line item name is registered approved XBRL tags. If you want to find the name of the tag, then click on one of the numbers with red lines above and below it.</p>
<p><img src="./resources/sec-edgar-10k-statement-of-operations.png" width="350"></p>
</section>
<section id="find-the-xbrl-tag-name-for-net-income" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="find-the-xbrl-tag-name-for-net-income"><span class="header-section-number">2.5</span> Find the XBRL tag name for <em>Net Income</em></h3>
<p>A pop-up window will appear (see below) showing the attributes of that line item value. Find the <em>Tag</em> attribute row, and copy the part that says, <em>‘NetincomeLoss’</em>. This is our XBRL tag name! We now have all of the information that we need to use the API.</p>
<p><img src="./resources/sec-edgar-popup-tag-name.png" width="350"></p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create a variable with the XBRL tag name.</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># Note that it is case sensitive.</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>xbrl_tag <span class="op">=</span> <span class="st">'NetIncomeLoss'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="api-data-pull" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="api-data-pull"><span class="header-section-number">3</span> API data pull</h2>
<p>In our example, we will attempt to plot the quarterly trend for Apple’s <em>Net Income</em> line item. We will be pulling the data from the <a href="https://www.sec.gov/edgar/sec-api-documentation">data.sec.gov api</a>.</p>
<section id="import-python-packages" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="import-python-packages"><span class="header-section-number">3.1</span> Import python packages</h3>
<p>These are the packages that we will need. All of them can be downloaded and installed with <a href="https://www.anaconda.com/products/distribution">Anaconda</a>.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">import</span> requests</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">import</span> json</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="im">import</span> re</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="im">import</span> pandasql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example</p>
</section>
<section id="make-the-api-call" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="make-the-api-call"><span class="header-section-number">3.2</span> Make the API Call</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Build up the API request URL</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>api_url_path <span class="op">=</span> <span class="st">'https://data.sec.gov/api/xbrl/companyconcept'</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>api_url_path<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>cik<span class="sc">}</span><span class="ss">/us-gaap/</span><span class="sc">{</span>xbrl_tag<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># Run the API request</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># Note the it will not run without your email address</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>email_address <span class="op">=</span> <span class="st">'your-email@example.com'</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>request_tag_data <span class="op">=</span> (</span>
<span id="cb5-9"><a href="#cb5-9"></a>    requests</span>
<span id="cb5-10"><a href="#cb5-10"></a>    .get(url, </span>
<span id="cb5-11"><a href="#cb5-11"></a>         headers<span class="op">=</span>{<span class="st">'User-Agent'</span>: email_address}))</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co"># Print the status code (200 is good, 404 is bad)</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="bu">print</span>(<span class="st">"Request status code:"</span>, request_tag_data.status_code)</span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="bu">print</span>(<span class="st">"Content Type:"</span>, request_tag_data.headers[<span class="st">'Content-Type'</span>])</span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="bu">print</span>(<span class="st">"Content Length:"</span>, </span>
<span id="cb5-17"><a href="#cb5-17"></a>      request_tag_data.headers[<span class="st">'Content-Length'</span>], <span class="st">'bytes'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Request status code: 200
Content Type: application/json
Content Length: 3281 bytes</code></pre>
</div>
</div>
</section>
<section id="take-a-look-at-the-raw-json-data" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="take-a-look-at-the-raw-json-data"><span class="header-section-number">3.3</span> Take a look at the raw JSON data</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>tag_data <span class="op">=</span> request_tag_data.json()</span>
<span id="cb7-2"><a href="#cb7-2"></a>pprint(tag_data, depth<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'cik': 320193,
 'description': 'The portion of profit or loss for the period, net of income '
                'taxes, which is attributable to the parent.',
 'entityName': 'Apple Inc.',
 'label': 'Net Income (Loss) Attributable to Parent',
 'tag': 'NetIncomeLoss',
 'taxonomy': 'us-gaap',
 'units': {'USD': [...]}}</code></pre>
</div>
</div>
</section>
<section id="convert-to-a-pandas-dataframe" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="convert-to-a-pandas-dataframe"><span class="header-section-number">3.4</span> Convert to a Pandas Dataframe</h3>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>df_tag_data <span class="op">=</span> pd.DataFrame.from_dict(tag_data[<span class="st">'units'</span>][<span class="st">'USD'</span>])</span>
<span id="cb9-2"><a href="#cb9-2"></a>df_tag_data.sort_values(by<span class="op">=</span>[<span class="st">'filed'</span>,<span class="st">'fy'</span>,<span class="st">'fp'</span>]).tail(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>start</th>
      <th>end</th>
      <th>val</th>
      <th>accn</th>
      <th>fy</th>
      <th>fp</th>
      <th>form</th>
      <th>filed</th>
      <th>frame</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>268</th>
      <td>2019-09-29</td>
      <td>2020-09-26</td>
      <td>57411000000</td>
      <td>0000320193-21-000105</td>
      <td>2021</td>
      <td>FY</td>
      <td>10-K</td>
      <td>2021-10-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>281</th>
      <td>2020-09-27</td>
      <td>2021-09-25</td>
      <td>94680000000</td>
      <td>0000320193-21-000105</td>
      <td>2021</td>
      <td>FY</td>
      <td>10-K</td>
      <td>2021-10-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>272</th>
      <td>2020-09-27</td>
      <td>2020-12-26</td>
      <td>28755000000</td>
      <td>0000320193-22-000007</td>
      <td>2022</td>
      <td>Q1</td>
      <td>10-Q</td>
      <td>2022-01-28</td>
      <td>CY2020Q4</td>
    </tr>
    <tr>
      <th>283</th>
      <td>2021-09-26</td>
      <td>2021-12-25</td>
      <td>34630000000</td>
      <td>0000320193-22-000007</td>
      <td>2022</td>
      <td>Q1</td>
      <td>10-Q</td>
      <td>2022-01-28</td>
      <td>CY2021Q4</td>
    </tr>
    <tr>
      <th>274</th>
      <td>2020-09-27</td>
      <td>2021-03-27</td>
      <td>52385000000</td>
      <td>0000320193-22-000059</td>
      <td>2022</td>
      <td>Q2</td>
      <td>10-Q</td>
      <td>2022-04-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>276</th>
      <td>2020-12-27</td>
      <td>2021-03-27</td>
      <td>23630000000</td>
      <td>0000320193-22-000059</td>
      <td>2022</td>
      <td>Q2</td>
      <td>10-Q</td>
      <td>2022-04-29</td>
      <td>CY2021Q1</td>
    </tr>
    <tr>
      <th>284</th>
      <td>2021-09-26</td>
      <td>2022-03-26</td>
      <td>59640000000</td>
      <td>0000320193-22-000059</td>
      <td>2022</td>
      <td>Q2</td>
      <td>10-Q</td>
      <td>2022-04-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>285</th>
      <td>2021-12-26</td>
      <td>2022-03-26</td>
      <td>25010000000</td>
      <td>0000320193-22-000059</td>
      <td>2022</td>
      <td>Q2</td>
      <td>10-Q</td>
      <td>2022-04-29</td>
      <td>CY2022Q1</td>
    </tr>
    <tr>
      <th>278</th>
      <td>2020-09-27</td>
      <td>2021-06-26</td>
      <td>74129000000</td>
      <td>0000320193-22-000070</td>
      <td>2022</td>
      <td>Q3</td>
      <td>10-Q</td>
      <td>2022-07-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>280</th>
      <td>2021-03-28</td>
      <td>2021-06-26</td>
      <td>21744000000</td>
      <td>0000320193-22-000070</td>
      <td>2022</td>
      <td>Q3</td>
      <td>10-Q</td>
      <td>2022-07-29</td>
      <td>CY2021Q2</td>
    </tr>
    <tr>
      <th>286</th>
      <td>2021-09-26</td>
      <td>2022-06-25</td>
      <td>79082000000</td>
      <td>0000320193-22-000070</td>
      <td>2022</td>
      <td>Q3</td>
      <td>10-Q</td>
      <td>2022-07-29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>287</th>
      <td>2022-03-27</td>
      <td>2022-06-25</td>
      <td>19442000000</td>
      <td>0000320193-22-000070</td>
      <td>2022</td>
      <td>Q3</td>
      <td>10-Q</td>
      <td>2022-07-29</td>
      <td>CY2022Q2</td>
    </tr>
    <tr>
      <th>269</th>
      <td>2019-09-29</td>
      <td>2020-09-26</td>
      <td>57411000000</td>
      <td>0000320193-22-000108</td>
      <td>2022</td>
      <td>FY</td>
      <td>10-K</td>
      <td>2022-10-28</td>
      <td>CY2020</td>
    </tr>
    <tr>
      <th>282</th>
      <td>2020-09-27</td>
      <td>2021-09-25</td>
      <td>94680000000</td>
      <td>0000320193-22-000108</td>
      <td>2022</td>
      <td>FY</td>
      <td>10-K</td>
      <td>2022-10-28</td>
      <td>CY2021</td>
    </tr>
    <tr>
      <th>288</th>
      <td>2021-09-26</td>
      <td>2022-09-24</td>
      <td>99803000000</td>
      <td>0000320193-22-000108</td>
      <td>2022</td>
      <td>FY</td>
      <td>10-K</td>
      <td>2022-10-28</td>
      <td>CY2022</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Note a few things about the above table:</p>
<ol type="1">
<li>There are multiple records for each quarter. This is because the financial report shows values for the current quarter, the previous quarter, and the current quarter from the previous fiscal year. It would be great if the API provided a filed describing which quarter time period was which. When we go to plot the graph we will only want to include the current quarters value for each quarter.</li>
<li>The values for Q1, Q2, and Q3 come from the form 10-Q. There is no 10-Q for Q4, and the 10-K report only shows yearly totals. In order to find the values for Q4 of each year we’ll need to take the annual total and subtract the totals from Q1-3.</li>
</ol>
</section>
</section>
<section id="clean-and-filter-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="clean-and-filter-data"><span class="header-section-number">4</span> Clean and filter data</h2>
<p>Since the data set does not have a column indicating which quarter each value is associated with, we will have to use a brute force approach. We’ll have to use a window function to pick a single record for each fiscal year &amp; quarter. The syntax for doing window operations in Pandas is a little weird, IMO. I think that it’s easier to do this in SQL, so lets use the <em>sqldf</em> function from the pandasql package.</p>
<section id="rank-records-over-fiscal-year-and-period" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="rank-records-over-fiscal-year-and-period"><span class="header-section-number">4.1</span> Rank records over fiscal year and period</h3>
<p>In our first SQL query (see below), we are going to rank records over partitions defined by fiscal year and fiscal period. We’ll calculate the number of days in between the dates <em>start</em> and <em>end</em>. And, finally, we’ll create a new <em>val_10q</em> column to indicate the values that came from 10-Q reports. We’ll need it later when we subtract the sum of the values for Q1-3 from the annual amount to calculate the Q4 value.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>df_rank <span class="op">=</span> pandasql.sqldf(<span class="st">"""</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">    select fy, fp, end, start,</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">        (   julianday(date(end))</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">           -julianday(date(start))</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">        ) as num_days_in_period,</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">        val, form,</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">        (   case </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">            when form='10-Q'</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">            then val</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="st">            else 0</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="st">            end</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="st">        ) as val_10q,</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="st">        rank()</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="st">        over(</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="st">            partition by fy, fp</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="st">            order by </span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="st">                end desc, </span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="st">                start desc</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="st">        ) as rnk</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="st">    from df_tag_data</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="st">    where form in('10-Q','10-K')</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="st">"""</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a></span>
<span id="cb10-24"><a href="#cb10-24"></a>df_rank.tail(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>fy</th>
      <th>fp</th>
      <th>end</th>
      <th>start</th>
      <th>num_days_in_period</th>
      <th>val</th>
      <th>form</th>
      <th>val_10q</th>
      <th>rnk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>249</th>
      <td>2021</td>
      <td>Q3</td>
      <td>2020-06-27</td>
      <td>2020-03-29</td>
      <td>90.0</td>
      <td>11253000000</td>
      <td>10-Q</td>
      <td>11253000000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>250</th>
      <td>2021</td>
      <td>Q3</td>
      <td>2020-06-27</td>
      <td>2019-09-29</td>
      <td>272.0</td>
      <td>44738000000</td>
      <td>10-Q</td>
      <td>44738000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>251</th>
      <td>2022</td>
      <td>FY</td>
      <td>2022-09-24</td>
      <td>2021-09-26</td>
      <td>363.0</td>
      <td>99803000000</td>
      <td>10-K</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>252</th>
      <td>2022</td>
      <td>FY</td>
      <td>2021-09-25</td>
      <td>2020-09-27</td>
      <td>363.0</td>
      <td>94680000000</td>
      <td>10-K</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>253</th>
      <td>2022</td>
      <td>FY</td>
      <td>2020-09-26</td>
      <td>2019-09-29</td>
      <td>363.0</td>
      <td>57411000000</td>
      <td>10-K</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>254</th>
      <td>2022</td>
      <td>Q1</td>
      <td>2021-12-25</td>
      <td>2021-09-26</td>
      <td>90.0</td>
      <td>34630000000</td>
      <td>10-Q</td>
      <td>34630000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>255</th>
      <td>2022</td>
      <td>Q1</td>
      <td>2020-12-26</td>
      <td>2020-09-27</td>
      <td>90.0</td>
      <td>28755000000</td>
      <td>10-Q</td>
      <td>28755000000</td>
      <td>2</td>
    </tr>
    <tr>
      <th>256</th>
      <td>2022</td>
      <td>Q2</td>
      <td>2022-03-26</td>
      <td>2021-12-26</td>
      <td>90.0</td>
      <td>25010000000</td>
      <td>10-Q</td>
      <td>25010000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>257</th>
      <td>2022</td>
      <td>Q2</td>
      <td>2022-03-26</td>
      <td>2021-09-26</td>
      <td>181.0</td>
      <td>59640000000</td>
      <td>10-Q</td>
      <td>59640000000</td>
      <td>2</td>
    </tr>
    <tr>
      <th>258</th>
      <td>2022</td>
      <td>Q2</td>
      <td>2021-03-27</td>
      <td>2020-12-27</td>
      <td>90.0</td>
      <td>23630000000</td>
      <td>10-Q</td>
      <td>23630000000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>259</th>
      <td>2022</td>
      <td>Q2</td>
      <td>2021-03-27</td>
      <td>2020-09-27</td>
      <td>181.0</td>
      <td>52385000000</td>
      <td>10-Q</td>
      <td>52385000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>260</th>
      <td>2022</td>
      <td>Q3</td>
      <td>2022-06-25</td>
      <td>2022-03-27</td>
      <td>90.0</td>
      <td>19442000000</td>
      <td>10-Q</td>
      <td>19442000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>261</th>
      <td>2022</td>
      <td>Q3</td>
      <td>2022-06-25</td>
      <td>2021-09-26</td>
      <td>272.0</td>
      <td>79082000000</td>
      <td>10-Q</td>
      <td>79082000000</td>
      <td>2</td>
    </tr>
    <tr>
      <th>262</th>
      <td>2022</td>
      <td>Q3</td>
      <td>2021-06-26</td>
      <td>2021-03-28</td>
      <td>90.0</td>
      <td>21744000000</td>
      <td>10-Q</td>
      <td>21744000000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>263</th>
      <td>2022</td>
      <td>Q3</td>
      <td>2021-06-26</td>
      <td>2020-09-27</td>
      <td>272.0</td>
      <td>74129000000</td>
      <td>10-Q</td>
      <td>74129000000</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="filter-the-dataframe-for-rank1-records" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="filter-the-dataframe-for-rank1-records"><span class="header-section-number">4.2</span> Filter the dataframe for rank=1 records</h3>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>df_filtered <span class="op">=</span> pandasql.sqldf(<span class="st">"""</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">    select </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">        fy, fp, </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">        end, start,</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">        num_days_in_period,</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">        val, form,</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">        sum(val_10q) </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">        over(partition by fy</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">            ) as total_val_10q</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="st">    from df_rank</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="st">    where rnk=1</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="st">"""</span>)</span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a>df_filtered.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>fy</th>
      <th>fp</th>
      <th>end</th>
      <th>start</th>
      <th>num_days_in_period</th>
      <th>val</th>
      <th>form</th>
      <th>total_val_10q</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>FY</td>
      <td>2009-09-26</td>
      <td>2008-09-28</td>
      <td>363.0</td>
      <td>5704000000</td>
      <td>10-K</td>
      <td>1229000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>Q3</td>
      <td>2009-06-27</td>
      <td>2009-03-29</td>
      <td>90.0</td>
      <td>1229000000</td>
      <td>10-Q</td>
      <td>1229000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010</td>
      <td>FY</td>
      <td>2010-09-25</td>
      <td>2010-06-27</td>
      <td>90.0</td>
      <td>4308000000</td>
      <td>10-K</td>
      <td>9705000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010</td>
      <td>Q1</td>
      <td>2009-12-26</td>
      <td>2009-09-27</td>
      <td>90.0</td>
      <td>3378000000</td>
      <td>10-Q</td>
      <td>9705000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010</td>
      <td>Q2</td>
      <td>2010-03-27</td>
      <td>2009-12-27</td>
      <td>90.0</td>
      <td>3074000000</td>
      <td>10-Q</td>
      <td>9705000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="finalize-data-for-plotting" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="finalize-data-for-plotting"><span class="header-section-number">4.3</span> Finalize data for plotting</h3>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>x_axis_name <span class="op">=</span> <span class="st">'End Date'</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>y_axis_name <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>xbrl_tag<span class="sc">}</span><span class="ss"> (USD in Billions)'</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>df_plot_data <span class="op">=</span> pandasql.sqldf(<span class="ss">f"""</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="ss">select</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="ss">    fy as `Fiscal Year`, </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="ss">    (   case </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="ss">        when fp='FY' then 'Q4'</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="ss">        else fp</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="ss">        end</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="ss">    ) as `Fiscal Quarter`,</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="ss">    end as `</span><span class="sc">{</span>x_axis_name<span class="sc">}</span><span class="ss">`,</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="ss">    round(   </span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="ss">        case when form='10-K' </span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="ss">            and num_days_in_period &gt; 360</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="ss">        then (val-total_val_10q)/1e9</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="ss">        else val/1e9</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="ss">        end, </span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="ss">        2</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="ss">    ) as `</span><span class="sc">{</span>y_axis_name<span class="sc">}</span><span class="ss">`</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="ss">from df_filtered</span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="ss">order by `</span><span class="sc">{</span>x_axis_name<span class="sc">}</span><span class="ss">`</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="ss">"""</span>)</span>
<span id="cb12-24"><a href="#cb12-24"></a></span>
<span id="cb12-25"><a href="#cb12-25"></a>df_plot_data.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Fiscal Year</th>
      <th>Fiscal Quarter</th>
      <th>End Date</th>
      <th>NetIncomeLoss (USD in Billions)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>49</th>
      <td>2021</td>
      <td>Q4</td>
      <td>2021-09-25</td>
      <td>20.55</td>
    </tr>
    <tr>
      <th>50</th>
      <td>2022</td>
      <td>Q1</td>
      <td>2021-12-25</td>
      <td>34.63</td>
    </tr>
    <tr>
      <th>51</th>
      <td>2022</td>
      <td>Q2</td>
      <td>2022-03-26</td>
      <td>25.01</td>
    </tr>
    <tr>
      <th>52</th>
      <td>2022</td>
      <td>Q3</td>
      <td>2022-06-25</td>
      <td>19.44</td>
    </tr>
    <tr>
      <th>53</th>
      <td>2022</td>
      <td>Q4</td>
      <td>2022-09-24</td>
      <td>20.72</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="show-trend-as-a-bart-chart" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="show-trend-as-a-bart-chart"><span class="header-section-number">5</span> Show trend as a bart chart</h2>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>alt.Chart(df_plot_data).mark_bar().encode(</span>
<span id="cb13-2"><a href="#cb13-2"></a>    x <span class="op">=</span> alt.X(x_axis_name, </span>
<span id="cb13-3"><a href="#cb13-3"></a>              axis <span class="op">=</span> alt.Axis(labelOverlap<span class="op">=</span><span class="st">'greedy'</span>)),</span>
<span id="cb13-4"><a href="#cb13-4"></a>    y <span class="op">=</span> y_axis_name,</span>
<span id="cb13-5"><a href="#cb13-5"></a>).properties(</span>
<span id="cb13-6"><a href="#cb13-6"></a>    title <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>ticker<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>y_axis_name<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    width <span class="op">=</span> <span class="dv">300</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>    height <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div id="altair-viz-c092d19ccba441b18da634c100c6ad3d"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c092d19ccba441b18da634c100c6ad3d") {
      outputDiv = document.getElementById("altair-viz-c092d19ccba441b18da634c100c6ad3d");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-bc2a3fdf7cfdf7fbd2bc41cf255112c5"}, "mark": "bar", "encoding": {"x": {"type": "nominal", "axis": {"labelOverlap": "greedy"}, "field": "End Date"}, "y": {"type": "quantitative", "field": "NetIncomeLoss (USD in Billions)"}}, "height": 200, "title": "AAPL - NetIncomeLoss (USD in Billions)", "width": 300, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-bc2a3fdf7cfdf7fbd2bc41cf255112c5": [{"Fiscal Year": 2009, "Fiscal Quarter": "Q3", "End Date": "2009-06-27", "NetIncomeLoss (USD in Billions)": 1.23}, {"Fiscal Year": 2009, "Fiscal Quarter": "Q4", "End Date": "2009-09-26", "NetIncomeLoss (USD in Billions)": 4.48}, {"Fiscal Year": 2010, "Fiscal Quarter": "Q1", "End Date": "2009-12-26", "NetIncomeLoss (USD in Billions)": 3.38}, {"Fiscal Year": 2010, "Fiscal Quarter": "Q2", "End Date": "2010-03-27", "NetIncomeLoss (USD in Billions)": 3.07}, {"Fiscal Year": 2010, "Fiscal Quarter": "Q3", "End Date": "2010-06-26", "NetIncomeLoss (USD in Billions)": 3.25}, {"Fiscal Year": 2010, "Fiscal Quarter": "Q4", "End Date": "2010-09-25", "NetIncomeLoss (USD in Billions)": 4.31}, {"Fiscal Year": 2011, "Fiscal Quarter": "Q1", "End Date": "2010-12-25", "NetIncomeLoss (USD in Billions)": 6.0}, {"Fiscal Year": 2011, "Fiscal Quarter": "Q2", "End Date": "2011-03-26", "NetIncomeLoss (USD in Billions)": 5.99}, {"Fiscal Year": 2011, "Fiscal Quarter": "Q3", "End Date": "2011-06-25", "NetIncomeLoss (USD in Billions)": 7.31}, {"Fiscal Year": 2011, "Fiscal Quarter": "Q4", "End Date": "2011-09-24", "NetIncomeLoss (USD in Billions)": 6.62}, {"Fiscal Year": 2012, "Fiscal Quarter": "Q1", "End Date": "2011-12-31", "NetIncomeLoss (USD in Billions)": 13.06}, {"Fiscal Year": 2012, "Fiscal Quarter": "Q2", "End Date": "2012-03-31", "NetIncomeLoss (USD in Billions)": 11.62}, {"Fiscal Year": 2012, "Fiscal Quarter": "Q3", "End Date": "2012-06-30", "NetIncomeLoss (USD in Billions)": 8.82}, {"Fiscal Year": 2012, "Fiscal Quarter": "Q4", "End Date": "2012-09-29", "NetIncomeLoss (USD in Billions)": 8.22}, {"Fiscal Year": 2013, "Fiscal Quarter": "Q1", "End Date": "2012-12-29", "NetIncomeLoss (USD in Billions)": 13.08}, {"Fiscal Year": 2013, "Fiscal Quarter": "Q2", "End Date": "2013-03-30", "NetIncomeLoss (USD in Billions)": 9.55}, {"Fiscal Year": 2013, "Fiscal Quarter": "Q3", "End Date": "2013-06-29", "NetIncomeLoss (USD in Billions)": 6.9}, {"Fiscal Year": 2013, "Fiscal Quarter": "Q4", "End Date": "2013-09-28", "NetIncomeLoss (USD in Billions)": 7.51}, {"Fiscal Year": 2014, "Fiscal Quarter": "Q1", "End Date": "2013-12-28", "NetIncomeLoss (USD in Billions)": 13.07}, {"Fiscal Year": 2014, "Fiscal Quarter": "Q2", "End Date": "2014-03-29", "NetIncomeLoss (USD in Billions)": 10.22}, {"Fiscal Year": 2014, "Fiscal Quarter": "Q3", "End Date": "2014-06-28", "NetIncomeLoss (USD in Billions)": 7.75}, {"Fiscal Year": 2014, "Fiscal Quarter": "Q4", "End Date": "2014-09-27", "NetIncomeLoss (USD in Billions)": 8.47}, {"Fiscal Year": 2015, "Fiscal Quarter": "Q1", "End Date": "2014-12-27", "NetIncomeLoss (USD in Billions)": 18.02}, {"Fiscal Year": 2015, "Fiscal Quarter": "Q2", "End Date": "2015-03-28", "NetIncomeLoss (USD in Billions)": 13.57}, {"Fiscal Year": 2015, "Fiscal Quarter": "Q3", "End Date": "2015-06-27", "NetIncomeLoss (USD in Billions)": 10.68}, {"Fiscal Year": 2015, "Fiscal Quarter": "Q4", "End Date": "2015-09-26", "NetIncomeLoss (USD in Billions)": 11.12}, {"Fiscal Year": 2016, "Fiscal Quarter": "Q1", "End Date": "2015-12-26", "NetIncomeLoss (USD in Billions)": 18.36}, {"Fiscal Year": 2016, "Fiscal Quarter": "Q2", "End Date": "2016-03-26", "NetIncomeLoss (USD in Billions)": 10.52}, {"Fiscal Year": 2016, "Fiscal Quarter": "Q3", "End Date": "2016-06-25", "NetIncomeLoss (USD in Billions)": 7.8}, {"Fiscal Year": 2016, "Fiscal Quarter": "Q4", "End Date": "2016-09-24", "NetIncomeLoss (USD in Billions)": 9.01}, {"Fiscal Year": 2017, "Fiscal Quarter": "Q1", "End Date": "2016-12-31", "NetIncomeLoss (USD in Billions)": 17.89}, {"Fiscal Year": 2017, "Fiscal Quarter": "Q2", "End Date": "2017-04-01", "NetIncomeLoss (USD in Billions)": 11.03}, {"Fiscal Year": 2017, "Fiscal Quarter": "Q3", "End Date": "2017-07-01", "NetIncomeLoss (USD in Billions)": 8.72}, {"Fiscal Year": 2017, "Fiscal Quarter": "Q4", "End Date": "2017-09-30", "NetIncomeLoss (USD in Billions)": 10.71}, {"Fiscal Year": 2018, "Fiscal Quarter": "Q1", "End Date": "2017-12-30", "NetIncomeLoss (USD in Billions)": 20.07}, {"Fiscal Year": 2018, "Fiscal Quarter": "Q2", "End Date": "2018-03-31", "NetIncomeLoss (USD in Billions)": 13.82}, {"Fiscal Year": 2018, "Fiscal Quarter": "Q3", "End Date": "2018-06-30", "NetIncomeLoss (USD in Billions)": 11.52}, {"Fiscal Year": 2018, "Fiscal Quarter": "Q4", "End Date": "2018-09-29", "NetIncomeLoss (USD in Billions)": 14.13}, {"Fiscal Year": 2019, "Fiscal Quarter": "Q1", "End Date": "2018-12-29", "NetIncomeLoss (USD in Billions)": 19.97}, {"Fiscal Year": 2019, "Fiscal Quarter": "Q2", "End Date": "2019-03-30", "NetIncomeLoss (USD in Billions)": 11.56}, {"Fiscal Year": 2019, "Fiscal Quarter": "Q3", "End Date": "2019-06-29", "NetIncomeLoss (USD in Billions)": 10.04}, {"Fiscal Year": 2019, "Fiscal Quarter": "Q4", "End Date": "2019-09-28", "NetIncomeLoss (USD in Billions)": 13.69}, {"Fiscal Year": 2020, "Fiscal Quarter": "Q1", "End Date": "2019-12-28", "NetIncomeLoss (USD in Billions)": 22.24}, {"Fiscal Year": 2020, "Fiscal Quarter": "Q2", "End Date": "2020-03-28", "NetIncomeLoss (USD in Billions)": 11.25}, {"Fiscal Year": 2020, "Fiscal Quarter": "Q3", "End Date": "2020-06-27", "NetIncomeLoss (USD in Billions)": 11.25}, {"Fiscal Year": 2020, "Fiscal Quarter": "Q4", "End Date": "2020-09-26", "NetIncomeLoss (USD in Billions)": 12.67}, {"Fiscal Year": 2021, "Fiscal Quarter": "Q1", "End Date": "2020-12-26", "NetIncomeLoss (USD in Billions)": 28.76}, {"Fiscal Year": 2021, "Fiscal Quarter": "Q2", "End Date": "2021-03-27", "NetIncomeLoss (USD in Billions)": 23.63}, {"Fiscal Year": 2021, "Fiscal Quarter": "Q3", "End Date": "2021-06-26", "NetIncomeLoss (USD in Billions)": 21.74}, {"Fiscal Year": 2021, "Fiscal Quarter": "Q4", "End Date": "2021-09-25", "NetIncomeLoss (USD in Billions)": 20.55}, {"Fiscal Year": 2022, "Fiscal Quarter": "Q1", "End Date": "2021-12-25", "NetIncomeLoss (USD in Billions)": 34.63}, {"Fiscal Year": 2022, "Fiscal Quarter": "Q2", "End Date": "2022-03-26", "NetIncomeLoss (USD in Billions)": 25.01}, {"Fiscal Year": 2022, "Fiscal Quarter": "Q3", "End Date": "2022-06-25", "NetIncomeLoss (USD in Billions)": 19.44}, {"Fiscal Year": 2022, "Fiscal Quarter": "Q4", "End Date": "2022-09-24", "NetIncomeLoss (USD in Billions)": 20.72}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="swied/swied-website" data-repo-id="R_kgDOIXVJVQ" data-category="General" data-category-id="DIC_kwDOIXVJVc4CSn3X" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>